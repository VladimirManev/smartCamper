# –ú–æ–∏ –±–µ–ª–µ–∂–∫–∏ - SmartCamper üöê

## üéØ –ö–∞–∫–≤–æ –ø—Ä–∞–≤–∏–º

–°–∏—Å—Ç–µ–º–∞ –∑–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –µ–ª–µ–∫—Ç—Ä–∏—á–µ—Å–∫–∞—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –∫–µ–º–ø–µ—Ä–∞. –¢—Ä–∏ —á–∞—Å—Ç–∏: –º–æ–∑—ä–∫ (Raspberry Pi), —Å–µ–Ω–∑–æ—Ä–∏ (ESP32), dashboard (React).

## ‚úÖ –ù–∞–ø—Ä–∞–≤–∏—Ö–º–µ –¥–Ω–µ—Å

### Backend (Express.js)

- ‚úÖ –ú–æ–¥—É–ª–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ - middleware, routes, socket –≤ –æ—Ç–¥–µ–ª–Ω–∏ –ø–∞–ø–∫–∏
- ‚úÖ Socket.io –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∑–∞ real-time –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è
- ‚úÖ MQTT broker (Aedes) –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ MQTT ‚Üî WebSocket bridge
- ‚úÖ –ì–ª–∞–≤–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –∏ health check endpoint
- ‚úÖ 404 –æ–±—Ä–∞–±–æ—Ç–∫–∞
- ‚úÖ –õ–æ–≥–≤–∞–Ω–µ –Ω–∞ –∑–∞—è–≤–∫–∏
- ‚úÖ CORS middleware –∑–∞ development
- ‚úÖ –ü—Ä–µ–º–∞—Ö–≤–∞–Ω–µ –Ω–∞ stale data –ø—Ä–∏ frontend connection

### Frontend (React + Vite)

- ‚úÖ React –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å Vite
- ‚úÖ WebSocket –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è —Å backend
- ‚úÖ Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –Ω–∞ —Å–µ–Ω–∑–æ—Ä–Ω–∏ –¥–∞–Ω–Ω–∏
- ‚úÖ useState –∏ useEffect hooks
- ‚úÖ –ü–æ–∫–∞–∑–≤–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç
- ‚úÖ –°—Ç–∞—Ç—É—Å –Ω–∞ –≤—Ä—ä–∑–∫–∞—Ç–∞ —Å Font Awesome –∏–∫–æ–Ω–∏
- ‚úÖ 30-—Å–µ–∫—É–Ω–¥–µ–Ω timeout –∑–∞ ESP32 —Å—Ç–∞—Ç—É—Å
- ‚úÖ –ò–∑—á–∏—Å—Ç–≤–∞–Ω–µ –Ω–∞ —Å—Ç–æ–π–Ω–æ—Å—Ç–∏ –ø—Ä–∏ offline —Å—Ç–∞—Ç—É—Å
- ‚úÖ –§–∏–∫—Å–∏—Ä–∞–Ω–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–∞–Ω–µ –Ω–∞ —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ (–≤—Å–µ–∫–∏ –ø—ä—Ç 1 –¥–µ—Å–µ—Ç–∏—á–µ–Ω –∑–Ω–∞–∫)
- ‚úÖ –ú–æ–¥–µ—Ä–µ–Ω –¥–∏–∑–∞–π–Ω —Å antracit background –∏ –∑–µ–ª–µ–Ω–∏ –∞–∫—Ü–µ–Ω—Ç–∏

### ESP32 Framework + Real Hardware

- ‚úÖ –†–µ–∞–ª–µ–Ω AM2301 (DHT22) —Å–µ–Ω–∑–æ—Ä –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
- ‚úÖ Heartbeat —Å–∏—Å—Ç–µ–º–∞ - –ø—Ä–∞—â–∞ –¥–∞–Ω–Ω–∏ –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞ –ò–õ–ò –Ω–∞ –≤—Å–µ–∫–∏ 10 —Å–µ–∫—É–Ω–¥–∏
- ‚úÖ CommandHandler –∑–∞ force update –∫–æ–º–∞–Ω–¥–∏ (–∑–∞–ø–∞–∑–µ–Ω –∑–∞ –±—ä–¥–µ—â–∏ –º–æ–¥—É–ª–∏)
- ‚úÖ –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è - –ø—Ä–∞—â–∞ —Å–∞–º–æ –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞
- ‚úÖ NetworkManager –∑–∞ WiFi —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
- ‚úÖ MQTTManager –∑–∞ MQTT –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è
- ‚úÖ SensorManager –∑–∞ —Ä–µ–∞–ª–Ω–∏ —Å–µ–Ω–∑–æ—Ä–Ω–∏ –¥–∞–Ω–Ω–∏
- ‚úÖ Config.h –∑–∞ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–∏—Ä–∞–Ω–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- ‚úÖ PlatformIO –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
- ‚úÖ –ú–æ–¥—É–ª–Ω–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ (separation of concerns)

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- ‚úÖ Backend –∫–∞—Ç–æ Gateway (ESP32 ‚Üî Backend ‚Üî Frontend)
- ‚úÖ MQTT –∑–∞ ESP32 –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è
- ‚úÖ WebSocket –∑–∞ real-time –¥–∞–Ω–Ω–∏
- ‚úÖ HTTP fetch –∑–∞ –±—ä–¥–µ—â–∞ –∏—Å—Ç–æ—Ä–∏—è (–≥—Ä–∞—Ñ–∏–∫–∏)
- ‚úÖ –ú–æ–¥—É–ª–µ–Ω –∏ —á–∏—Å—Ç –∫–æ–¥ (senior dev —Å—Ç–∏–ª)

## üîß –ö–∞–∫–≤–æ —Ä–∞–±–æ—Ç–∏

**Backend (–ø–æ—Ä—Ç 3000):**

- `http://localhost:3000` - –≥–ª–∞–≤–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞
- `http://localhost:3000/health` - health check
- `ws://localhost:3000` - WebSocket —Å—ä—Ä–≤—ä—Ä
- `mqtt://localhost:1883` - MQTT broker (Aedes)

**Frontend (–ø–æ—Ä—Ç 5174):**

- `http://localhost:5174` - React dashboard
- Real-time —Ç–µ–º–ø–µ—Ä–∞—Ç—É—Ä–∞ –∏ –≤–ª–∞–∂–Ω–æ—Å—Ç
- Font Awesome –∏–∫–æ–Ω–∏ –∑–∞ —Å—Ç–∞—Ç—É—Å (–∑–µ–ª–µ–Ω–∏/—á–µ—Ä–≤–µ–Ω–∏)
- 30-—Å–µ–∫—É–Ω–¥–µ–Ω timeout –∑–∞ ESP32 offline detection
- –ú–æ–¥–µ—Ä–µ–Ω –¥–∏–∑–∞–π–Ω —Å antracit background

**ESP32 Framework + Real Hardware:**

- –†–µ–∞–ª–Ω–∏ –¥–∞–Ω–Ω–∏ –æ—Ç AM2301 (DHT22) —Å–µ–Ω–∑–æ—Ä
- Heartbeat —Å–∏—Å—Ç–µ–º–∞ - –≥–∞—Ä–∞–Ω—Ç–∏—Ä–∞–Ω–æ –∏–∑–ø—Ä–∞—â–∞–Ω–µ –Ω–∞ –≤—Å–µ–∫–∏ 10 —Å–µ–∫—É–Ω–¥–∏
- –û–ø—Ç–∏–º–∏–∑–∏—Ä–∞–Ω–æ MQTT –ø—É–±–ª–∏–∫—É–≤–∞–Ω–µ (—Å–∞–º–æ –ø—Ä–∏ –ø—Ä–æ–º—è–Ω–∞)
- Force Update –∫–æ–º–∞–Ω–¥–∏ –æ—Ç backend (–∑–∞–ø–∞–∑–µ–Ω–∏ –∑–∞ –±—ä–¥–µ—â–∏ –º–æ–¥—É–ª–∏)
- WiFi —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–ø–æ–¥–∫–ª—é—á–≤–∞–Ω–µ
- CommandHandler –∑–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ –Ω–∞ –∫–æ–º–∞–Ω–¥–∏
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∑–∞ –≤—Å–∏—á–∫–∏ –º–æ–¥—É–ª–∏

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
smartCamper/
‚îú‚îÄ‚îÄ backend/              # Express —Å—ä—Ä–≤—ä—Ä + Socket.io + MQTT
‚îÇ   ‚îú‚îÄ‚îÄ server.js        # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ middleware/      # CORS, Logger
‚îÇ   ‚îú‚îÄ‚îÄ routes/          # HTTP routes
‚îÇ   ‚îú‚îÄ‚îÄ socket/          # WebSocket –ª–æ–≥–∏–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ mqtt/            # MQTT broker (Aedes)
‚îú‚îÄ‚îÄ frontend/            # React + Vite
‚îÇ   ‚îî‚îÄ‚îÄ src/
‚îÇ       ‚îú‚îÄ‚îÄ App.jsx     # –ì–ª–∞–≤–µ–Ω –∫–æ–º–ø–æ–Ω–µ–Ω—Ç
‚îÇ       ‚îî‚îÄ‚îÄ App.css     # –°—Ç–∏–ª–æ–≤–µ
‚îú‚îÄ‚îÄ esp32-modules/       # ESP32 Universal Framework
‚îÇ   ‚îî‚îÄ‚îÄ temperature-sensor/    # –ö–æ–Ω–∫—Ä–µ—Ç–µ–Ω –º–æ–¥—É–ª —Å —Ä–µ–∞–ª–Ω–∏ —Å–µ–Ω–∑–æ—Ä–∏
‚îÇ       ‚îú‚îÄ‚îÄ platformio.ini
‚îÇ       ‚îú‚îÄ‚îÄ include/
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ SensorManager.h
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ CommandHandler.h
‚îÇ       ‚îî‚îÄ‚îÄ src/
‚îÇ           ‚îú‚îÄ‚îÄ Config.h           # –ù–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ           ‚îú‚îÄ‚îÄ NetworkManager.*   # WiFi
‚îÇ           ‚îú‚îÄ‚îÄ MQTTManager.*      # MQTT
‚îÇ           ‚îú‚îÄ‚îÄ CommandHandler.cpp # Force Update –∫–æ–º–∞–Ω–¥–∏
‚îÇ           ‚îú‚îÄ‚îÄ SensorManager.cpp  # –†–µ–∞–ª–Ω–∏ AM2301 –¥–∞–Ω–Ω–∏
‚îÇ           ‚îî‚îÄ‚îÄ main.cpp
‚îú‚îÄ‚îÄ PROJECT_LOG.md       # –î–µ—Ç–∞–π–ª–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îî‚îÄ‚îÄ MY_NOTES.md         # –¢–æ–∑–∏ —Ñ–∞–π–ª
```

## üöÄ –°–ª–µ–¥–≤–∞—â–æ

- –î–æ–±–∞–≤—è–Ω–µ –Ω–∞ –Ω–æ–≤–∏ ESP32 –º–æ–¥—É–ª–∏ (water sensor, battery monitor)
- –ë–∞–∑–∞ –¥–∞–Ω–Ω–∏ –∑–∞ –∏—Å—Ç–æ—Ä–∏—è –Ω–∞ –¥–∞–Ω–Ω–∏—Ç–µ
- –ì—Ä–∞—Ñ–∏–∫–∏ –∑–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏ –¥–∞–Ω–Ω–∏
- –ö–æ–Ω—Ç—Ä–æ–ª –Ω–∞ —Ä–µ–ª–µ—Ç–∞/–∫–æ–Ω—Å—É–º–∞—Ç–æ—Ä–∏
- –ú–æ–±–∏–ª–Ω–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –Ω–∞ frontend
- Push notifications –∑–∞ –∫—Ä–∏—Ç–∏—á–Ω–∏ —Å—ä–±–∏—Ç–∏—è

## üí° –ü–æ–ª–µ–∑–Ω–æ

```bash
# Backend
cd backend
npm start                    # –°—Ç–∞—Ä—Ç–∏—Ä–∞ —Å—ä—Ä–≤—ä—Ä–∞ –Ω–∞ :3000

# Frontend
cd frontend
npm run dev                  # –°—Ç–∞—Ä—Ç–∏—Ä–∞ Vite dev server –Ω–∞ :5174

# ESP32 (PlatformIO)
cd esp32-modules/temperature-sensor
pio run                      # –ö–æ–º–ø–∏–ª–∏—Ä–∞–Ω–µ
pio run --target upload      # –ö–∞—á–≤–∞–Ω–µ –Ω–∞ –ø–ª–∞—Ç–∫–∞—Ç–∞
pio device monitor           # –°–µ—Ä–∏–µ–Ω –º–æ–Ω–∏—Ç–æ—Ä

# –£–±–∏–π –ø—Ä–æ—Ü–µ—Å –Ω–∞ –ø–æ—Ä—Ç
lsof -ti:3000 | xargs kill -9
```

## üìö –ö–ª—é—á–æ–≤–∏ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏

**React:**

- `useState` - state management
- `useEffect` - side effects (WebSocket connection)
- `cleanup function` - disconnect –ø—Ä–∏ unmount

**Socket.io:**

- `io.on("connection")` - backend —Å–ª—É—à–∞
- `socket.emit()` - backend –∏–∑–ø—Ä–∞—â–∞
- `socket.on()` - frontend —Å–ª—É—à–∞

**ESP32/C++:**

- `class` - –≥—Ä—É–ø–∏—Ä–∞–Ω–µ –Ω–∞ –¥–∞–Ω–Ω–∏ –∏ —Ñ—É–Ω–∫—Ü–∏–∏
- `static` - –ø—Ä–æ–º–µ–Ω–ª–∏–≤–∏ –∑–∞–ø–∞–∑–≤–∞—Ç —Å—Ç–æ–π–Ω–æ—Å—Ç –º–µ–∂–¥—É –∏–∑–≤–∏–∫–≤–∞–Ω–∏—è—Ç–∞
- `WiFi.mode(WIFI_STA)` - Station —Ä–µ–∂–∏–º –∑–∞ —Å–≤—ä—Ä–∑–≤–∞–Ω–µ –∫—ä–º WiFi
- `mqttClient.publish()` - MQTT –ø—É–±–ª–∏–∫—É–≤–∞–Ω–µ
- `millis()` - –≤—Ä–µ–º–µ –≤ –º–∏–ª–∏—Å–µ–∫—É–Ω–¥–∏ –æ—Ç —Å—Ç–∞—Ä—Ç–∏—Ä–∞–Ω–µ

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**

- MQTT –∑–∞ ESP32 –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è ‚úÖ
- WebSocket –∑–∞ real-time –¥–∞–Ω–Ω–∏ ‚úÖ
- HTTP –¥–ª—è –∏—Å—Ç–æ—Ä–∏—è/–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ‚úÖ
- Backend –∫–∞—Ç–æ Gateway ‚úÖ
- –ú–æ–¥—É–ª–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ ‚úÖ

## üéØ –í–∞–∂–Ω–∏ —Ä–µ—à–µ–Ω–∏—è

1. **–ù–ò–ö–û–ì–ê –¥–∏—Ä–µ–∫—Ç–Ω–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—è Frontend ‚Üî ESP32**

   - –í–∏–Ω–∞–≥–∏ –ø—Ä–µ–∑ Backend –∫–∞—Ç–æ Gateway
   - Backend –≤–∞–ª–∏–¥–∏—Ä–∞, —Ñ–∏–ª—Ç—Ä–∏—Ä–∞, –¥–æ–±–∞–≤—è –ª–æ–≥–∏–∫–∞

2. **WebSocket –∑–∞ real-time, HTTP –∑–∞ –∏—Å—Ç–æ—Ä–∏—è**

   - Socket.io –∑–∞ live —Å–µ–Ω–∑–æ—Ä–Ω–∏ –¥–∞–Ω–Ω–∏
   - fetch() –∑–∞ –∏—Å—Ç–æ—Ä–∏—è –æ—Ç –±–∞–∑–∞ –¥–∞–Ω–Ω–∏

3. **–ú–æ–¥—É–ª–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞**

   - –í—Å–µ–∫–∏ —Ñ–∞–π–ª –∏–º–∞ –ï–î–ù–ê –æ—Ç–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç
   - –õ–µ—Å–Ω–æ —Ç–µ—Å—Ç–≤–∞–Ω–µ –∏ –ø–æ–¥–¥—Ä—ä–∂–∫–∞

4. **–ü—Ä–æ—Å—Ç–æ—Ç–∞**
   - –ß–∏—Å—Ç –∏ –ø—Ä–æ—Å—Ç –∫–æ–¥
   - –ë–µ–∑ –∏–∑–ª–∏—à–Ω–∏ —É—Å–ª–æ–∂–Ω–µ–Ω–∏—è

---

_–ü–æ—Å–ª–µ–¥–Ω–æ –æ–±–Ω–æ–≤—è–≤–∞–Ω–µ: 2025-10-14_
_–°—Ç–∞—Ç—É—Å: Heartbeat —Å–∏—Å—Ç–µ–º–∞ + Frontend timeout handling –≥–æ—Ç–æ–≤–∏ ‚úÖ_
